$(document).ready(function(){function show_uploading(){$('#dropzone').hide();is_document_dragenter=false;$('#form-errors').empty();$('#upload').hide();$('#uploading').show();}
function hide_uploading(){$('#upload').show();$('#uploading').hide();$('#dropzone').hide();}
$('#fileupload').fileupload({url:'/async-upload/',dataType:'json',acceptFileTypes:/(\.mp3|^[^\.]+)$/i,maxFileSize:16000000,lastData:null,maxNumberOfFiles:1,currNumberOfFiles:0,getNumberOfFiles:function(){return this.currNumberOfFiles;},isSingleFileSelected:false,messages:{maxNumberOfFiles:'Maximum number of files exceeded. Please upload only one file at a time.',acceptFileTypes:'Sorry, only .mp3 files are supported at this time.',maxFileSize:'File is too large. Only files less than 15 MB are currently supported.'}}).on('fileuploadadd',function(e,data){currNumberOfFiles=$(this).fileupload('option','currNumberOfFiles');$(this).fileupload('option','currNumberOfFiles',currNumberOfFiles+1);f=data.files[0];data.files[0].type='';$('#uploading .filename').text(f.name+' ('+numeral(f.size).format('0.0 b')+')');if(currNumberOfFiles<$(this).fileupload('option','maxNumberOfFiles')){d=data.submit();$(this).fileupload('option','lastData',d);}
show_uploading();}).on('fileuploadprocessfail',function(e,data){hide_uploading();data.abort();$(this).fileupload('option','lastData').abort();var file=data.files[data.index];$('#form-errors').append('<div class="alert alert-danger">'+file.error+'</div>');$(this).fileupload('option','currNumberOfFiles',0);}).on('fileuploadprogress',function(e,data){var progress=parseInt(data.loaded/data.total*100,10);$('#progressbar .progress-bar').width(progress+'%');$('#progressbar .sr-only').text(progress+'% complete');var progressinfo='';var uploaded_size=numeral(data.loaded).format('0.0 b');var total_size=numeral(data.total).format('0.0 b');var upload_rate=numeral(data.bitrate/10.0).format('0.0 b');progressinfo+='<strong>'+progress+'%</strong> uploaded (<strong>';progressinfo+=uploaded_size+'</strong> of '+total_size;progressinfo+=') at <strong>'+upload_rate+'/s</strong>';$('#progressinfo').html(progressinfo);}).on('fileuploaddone',function(e,data){switch(data.result.status){case 'success':window.location.href=data.result.redirect;break;case 'error':hide_uploading();$.each(data.result.error,function(i,v){$('#form-errors').append('<div class="alert alert-danger">'+v+'</div>');});break;default:break;}
$(this).fileupload('option','currNumberOfFiles',0);});$('#select-another').click(function(e){e.preventDefault();hide_uploading();$(this).fileupload('option','currNumberOfFiles',0);});var is_document_dragenter=false;$(document).bind('dragenter',function(e){if(is_document_dragenter)return false;$('#dropzone').fadeIn(250);is_document_dragenter=true;return false;});$("#dropzone").bind('dragleave',function(e){e.stopPropagation();e.preventDefault();if(window.event.pageX==0||window.event.pageY==0){$(this).fadeOut(250);is_document_dragenter=false;return false;}});});